<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªçµ±åˆãƒ¬ãƒãƒ¼ãƒˆ - {{ report_date }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªçµ±åˆãƒ¬ãƒãƒ¼ãƒˆ</h1>
            <div class="subtitle">å…¨ä½“æˆ¦ç•¥ + 9éŠ˜æŸ„çµ±åˆåˆ†æ - {{ report_date }}</div>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showSection('overview')">ğŸ“Š æ¦‚è¦</div>
            <div class="nav-tab" onclick="showSection('optimization')">ğŸ¯ æœ€é©åŒ–</div>
            {% for ticker, info in portfolio.items() %}
            <div class="nav-tab stock-tab" onclick="showSection('{{ ticker.lower() }}')" style="border-left-color: {{ info.color }}">{{ ticker }}</div>
            {% endfor %}
        </div>
        
        <!-- æ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="overview" class="content-section active">
            <h2>ğŸ“Š ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ¦‚è¦</h2>
            
            <div class="portfolio-grid">
                <div class="stock-card">
                    <h3>ğŸ¯ æŠ•è³‡æˆ¦ç•¥</h3>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-label">ç·éŠ˜æŸ„æ•°</div>
                            <div class="metric-value">{{ portfolio|length }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">ã‚»ã‚¯ã‚¿ãƒ¼æ•°</div>
                            <div class="metric-value">{{ sectors|length }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">æŠ•è³‡æœŸé–“</div>
                            <div class="metric-value">3-5å¹´</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">ãƒªã‚¹ã‚¯æ°´æº–</div>
                            <div class="metric-value">ä¸­ã€œé«˜</div>
                        </div>
                    </div>
                </div>
                
                <div class="stock-card">
                    <h3>âš–ï¸ 4å°‚é–€å®¶è©•ä¾¡ã‚¹ã‚³ã‚¢</h3>
                    <div class="expert-scores-overview">
                        {% for ticker, scores in expert_scores.items() %}
                        <div class="score-row">
                            <div class="ticker-label">{{ ticker }}</div>
                            <div class="scores-grid">
                                <div class="score-item tech">
                                    <span class="score-label">TECH</span>
                                    <span class="score-value">{{ scores.TECH }}â˜…</span>
                                </div>
                                <div class="score-item fund">
                                    <span class="score-label">FUND</span>
                                    <span class="score-value">{{ scores.FUND }}â˜…</span>
                                </div>
                                <div class="score-item macro">
                                    <span class="score-label">MACRO</span>
                                    <span class="score-value">{{ scores.MACRO }}â˜…</span>
                                </div>
                                <div class="score-item risk">
                                    <span class="score-label">RISK</span>
                                    <span class="score-value">{{ scores.RISK }}â˜…</span>
                                </div>
                                <div class="score-item overall">
                                    <span class="score-label">ç·åˆ</span>
                                    <span class="score-value overall-score">{{ scores.OVERALL }}â˜…</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="stock-card">
                    <h3>âš–ï¸ é…åˆ†æ–¹é‡</h3>
                    <div class="analysis-section">
                        <div><strong>ã‚³ã‚¢éŠ˜æŸ„ï¼ˆ20%ï¼‰:</strong> TSLA, FSLR</div>
                        <div><strong>æˆé•·éŠ˜æŸ„ï¼ˆ10%ï¼‰:</strong> RKLB, ASTS, OKLO, JOBY, OII</div>
                        <div><strong>é«˜ãƒªã‚¹ã‚¯éŠ˜æŸ„ï¼ˆ5%ï¼‰:</strong> LUNR, RDW</div>
                    </div>
                </div>
            </div>
            
            <div class="portfolio-grid">
                {% for ticker, info in portfolio.items() %}
                {% set metrics = stock_metrics.get(ticker) %}
                <div class="stock-card" style="border-left-color: {{ info.color }}">
                    <div class="stock-header">
                        <div class="stock-ticker">{{ ticker }}</div>
                        <div class="stock-weight">{{ info.weight }}%</div>
                    </div>
                    <div class="stock-name">{{ info.name }}</div>
                    <div class="stock-sector">{{ info.sector }}</div>
                    
                    <div class="metrics-grid">
                        {% if metrics %}
                        <div class="metric-item">
                            <div class="metric-label">ç¾åœ¨ä¾¡æ ¼</div>
                            <div class="metric-value">${{ "%.2f"|format(metrics.current_price) }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">å‰æ—¥æ¯”</div>
                            <div class="metric-value {{ 'positive' if metrics.change_pct >= 0 else 'negative' }}">
                                {{ '+' if metrics.change_pct >= 0 else '' }}{{ "%.2f"|format(metrics.change_pct) }}%
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">RSI</div>
                            <div class="metric-value">{{ "%.1f"|format(metrics.rsi) }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">æ™‚ä¾¡ç·é¡</div>
                            <div class="metric-value">${{ "%.1f"|format(metrics.market_cap/1e9) }}B</div>
                        </div>
                        {% else %}
                        <div class="metric-item" style="grid-column: 1 / -1;">
                            <div class="metric-label">ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼</div>
                            <div class="metric-value" style="color: #e74c3c;">ä¸€æ™‚çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="analysis-section">
                <h3>ğŸ’¡ æŠ•è³‡æ–¹é‡</h3>
                <p>æœ¬ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã¯ã€æ¬¡ä¸–ä»£ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚»ã‚¯ã‚¿ãƒ¼ã¸ã®åˆ†æ•£æŠ•è³‡ã‚’é€šã˜ã¦ã€
                ä¸­é•·æœŸçš„ãªæˆé•·ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚EVãƒ»å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ã‚³ã‚¢ã¨ã—ã¤ã¤ã€
                å®‡å®™ãƒ»èˆªç©ºãƒ»æµ·æ´‹ã¨ã„ã£ãŸæ–°é ˜åŸŸã¸ã®æŠ•è³‡æ©Ÿä¼šã‚‚ç©æ¥µçš„ã«æ‰ãˆã¦ã„ã¾ã™ã€‚</p>
            </div>
        </div>
        
        <!-- æœ€é©åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="optimization" class="content-section">
            <h2>ğŸ¯ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–</h2>
            
            <div class="analysis-section">
                <h3>ğŸ“ˆ ç¾åœ¨é…åˆ† vs æ¨å¥¨é…åˆ†</h3>
                <table class="optimization-table">
                    <thead>
                        <tr>
                            <th>éŠ˜æŸ„</th>
                            <th>ã‚»ã‚¯ã‚¿ãƒ¼</th>
                            <th>ç¾åœ¨é…åˆ†</th>
                            <th>æ¨å¥¨é…åˆ†</th>
                            <th>å¤‰æ›´å¹…</th>
                            <th>ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ticker, info in portfolio.items() %}
                        {% set current = optimization.current_allocation[ticker] %}
                        {% set recommended = optimization.recommended_allocation[ticker] %}
                        {% set change = recommended - current %}
                        {% set risk = optimization.risk_metrics[ticker] %}
                        <tr>
                            <td><strong>{{ ticker }}</strong></td>
                            <td>{{ info.sector }}</td>
                            <td>{{ "%.2f"|format(current) }}%</td>
                            <td>{{ "%.2f"|format(recommended) }}%</td>
                            <td class="{{ 'positive' if change > 0 else 'negative' if change < 0 else '' }}">
                                {{ '+' if change > 0 else '' }}{{ "%.2f"|format(change) }}%
                            </td>
                            <td style="color: {{ 'var(--danger-color)' if risk >= 7 else 'var(--warning-color)' if risk >= 5 else 'var(--success-color)' }}">
                                {{ risk }}/10
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="strategy-cards">
                <div class="strategy-card">
                    <h4>ğŸ›¡ï¸ ãƒªã‚¹ã‚¯ç®¡ç†</h4>
                    <p>é«˜ãƒªã‚¹ã‚¯éŠ˜æŸ„ï¼ˆASTSã€OKLOã€LUNRã€RDWï¼‰ã®é…åˆ†ã‚’æŠ‘åˆ¶ã—ã€
                    å®‰å®šæˆé•·éŠ˜æŸ„ï¼ˆTSLAã€FSLRï¼‰ã®æ¯”é‡ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã§ã€
                    ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå…¨ä½“ã®ãƒªã‚¹ã‚¯ã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>
                </div>
                
                <div class="strategy-card">
                    <h4>ğŸ“ˆ æˆé•·æ€§é‡è¦–</h4>
                    <p>å®‡å®™ãƒ»èˆªç©ºã‚»ã‚¯ã‚¿ãƒ¼ï¼ˆRKLBã€ASTSã€LUNRï¼‰ã¯é«˜ã„æˆé•·æ€§ã‚’æŒã¤ãŸã‚ã€
                    ãƒªã‚¹ã‚¯ã‚’è€ƒæ…®ã—ã¤ã¤ã‚‚ä¸€å®šã®é…åˆ†ã‚’ç¶­æŒã—ã€
                    é•·æœŸçš„ãªæˆé•·æ©Ÿä¼šã‚’æ‰ãˆã¾ã™ã€‚</p>
                </div>
                
                <div class="strategy-card">
                    <h4>ğŸ¯ åˆ†æ•£æŠ•è³‡</h4>
                    <p>9ã¤ã®ç•°ãªã‚‹ã‚»ã‚¯ã‚¿ãƒ¼ã¸ã®åˆ†æ•£ã«ã‚ˆã‚Šã€
                    ç‰¹å®šã‚»ã‚¯ã‚¿ãƒ¼ã®ãƒªã‚¹ã‚¯ã‚’è»½æ¸›ã—ã¤ã¤ã€
                    æ¬¡ä¸–ä»£ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼å…¨ä½“ã®æˆé•·ã‚’äº«å—ã—ã¾ã™ã€‚</p>
                </div>
            </div>
        </div>
        
        <!-- å€‹åˆ¥éŠ˜æŸ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        {% for ticker, info in portfolio.items() %}
        <div id="{{ ticker.lower() }}" class="content-section">
            <h2 style="color: {{ info.color }};">{{ ticker }} - {{ info.name }}</h2>
            
            {% set metrics = stock_metrics.get(ticker) %}
            {% set financial = financial_metrics.get(ticker) %}
            {% set scores = expert_scores.get(ticker) %}
            {% set discussion = discussion_reports.get(ticker) %}
            {% set competitor = competitor_reports.get(ticker) %}
            
            {% if scores %}
            <div class="analysis-section">
                <h3>âš–ï¸ 4å°‚é–€å®¶è©•ä¾¡ã‚¹ã‚³ã‚¢</h3>
                <div class="expert-scores-detail">
                    <div class="scores-grid-large">
                        <div class="score-card tech">
                            <div class="score-header">
                                <div class="score-icon">ğŸ“ˆ</div>
                                <div class="score-title">TECH</div>
                                <div class="score-value-large">{{ scores.TECH }}â˜…</div>
                            </div>
                            <div class="score-description">ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æ</div>
                        </div>
                        <div class="score-card fund">
                            <div class="score-header">
                                <div class="score-icon">ğŸ’°</div>
                                <div class="score-title">FUND</div>
                                <div class="score-value-large">{{ scores.FUND }}â˜…</div>
                            </div>
                            <div class="score-description">ãƒ•ã‚¡ãƒ³ãƒ€ãƒ¡ãƒ³ã‚¿ãƒ«åˆ†æ</div>
                        </div>
                        <div class="score-card macro">
                            <div class="score-header">
                                <div class="score-icon">ğŸŒ</div>
                                <div class="score-title">MACRO</div>
                                <div class="score-value-large">{{ scores.MACRO }}â˜…</div>
                            </div>
                            <div class="score-description">ãƒã‚¯ãƒ­ç’°å¢ƒ</div>
                        </div>
                        <div class="score-card risk">
                            <div class="score-header">
                                <div class="score-icon">ğŸ›¡ï¸</div>
                                <div class="score-title">RISK</div>
                                <div class="score-value-large">{{ scores.RISK }}â˜…</div>
                            </div>
                            <div class="score-description">ãƒªã‚¹ã‚¯ç®¡ç†</div>
                        </div>
                    </div>
                    <div class="overall-score-card">
                        <div class="overall-header">
                            <div class="overall-title">ç·åˆè©•ä¾¡</div>
                            <div class="overall-value">{{ scores.OVERALL }}â˜…</div>
                        </div>
                        <div class="overall-description">
                            {% if scores.OVERALL >= 4.0 %}
                            å¼·ã„è²·ã„æ¨å¥¨
                            {% elif scores.OVERALL >= 3.5 %}
                            è²·ã„æ¨å¥¨
                            {% elif scores.OVERALL >= 3.0 %}
                            ä¸­ç«‹
                            {% elif scores.OVERALL >= 2.5 %}
                            å¼±ã„å£²ã‚Š
                            {% else %}
                            å£²ã‚Šæ¨å¥¨
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if metrics %}
            <div class="analysis-section">
                <h3>ğŸ“Š åŸºæœ¬æƒ…å ±</h3>
                <div class="stock-header">
                    <div class="stock-ticker">{{ ticker }}</div>
                    <div class="stock-weight">{{ info.weight }}%</div>
                </div>
                <div class="stock-name">{{ info.name }}</div>
                <div class="stock-sector">{{ info.sector }}</div>
                
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">ç¾åœ¨ä¾¡æ ¼</div>
                        <div class="metric-value">${{ "%.2f"|format(metrics.current_price) }}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">å‰æ—¥æ¯”</div>
                        <div class="metric-value {{ 'positive' if metrics.change_pct >= 0 else 'negative' }}">
                            {{ '+' if metrics.change_pct >= 0 else '' }}{{ "%.2f"|format(metrics.change_pct) }}%
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">æ™‚ä¾¡ç·é¡</div>
                        <div class="metric-value">${{ "%.1f"|format(metrics.market_cap/1e9) }}B</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªé…åˆ†</div>
                        <div class="metric-value">{{ info.weight }}%</div>
                    </div>
                </div>
            </div>
            
            {% if financial %}
            <div class="analysis-section">
                <h3>ğŸ’° è²¡å‹™åˆ†æ</h3>
                <table class="financial-table">
                    <tr><th>æŒ‡æ¨™</th><th>å€¤</th></tr>
                    <tr><td>æ™‚ä¾¡ç·é¡</td><td>${{ "%.1f"|format(financial.market_cap/1e9) }}B</td></tr>
                    <tr><td>äºˆæƒ³PER</td><td>{{ financial.pe_ratio if financial.pe_ratio != 'N/A' else 'N/A' }}</td></tr>
                    <tr><td>ROE</td><td>{{ "%.1f"|format(financial.roe*100) }}%</td></tr>
                    <tr><td>åˆ©ç›Šç‡</td><td>{{ "%.1f"|format(financial.profit_margin*100) }}%</td></tr>
                    <tr><td>å£²ä¸Šæˆé•·ç‡</td><td>{{ "%.1f"|format(financial.revenue_growth*100) }}%</td></tr>
                </table>
            </div>
            {% endif %}
            
            <div class="analysis-section">
                <h3>ğŸ“ˆ æŠ€è¡“æŒ‡æ¨™</h3>
                <div class="technical-indicators">
                    <div class="indicator-card">
                        <div class="indicator-value {{ 'rsi-overbought' if metrics.rsi > 70 else 'rsi-oversold' if metrics.rsi < 30 else 'rsi-neutral' }}">
                            {{ "%.1f"|format(metrics.rsi) }}
                        </div>
                        <div class="metric-label">RSI (14)</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-value">${{ "%.2f"|format(metrics.ema20) }}</div>
                        <div class="metric-label">EMA 20</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-value">${{ "%.2f"|format(metrics.ema50) }}</div>
                        <div class="metric-label">EMA 50</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-value">${{ "%.2f"|format(metrics.sma200) }}</div>
                        <div class="metric-label">SMA 200</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-value">${{ "%.2f"|format(metrics.bb_upper) }}</div>
                        <div class="metric-label">BB ä¸Šé™</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-value">${{ "%.2f"|format(metrics.bb_lower) }}</div>
                        <div class="metric-label">BB ä¸‹é™</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if discussion %}
            <div class="analysis-section" id="{{ ticker.lower() }}-discussion">
                <h3>ğŸ¯ 4å°‚é–€å®¶è¨è«–ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                <div class="discussion-tabs">
                    <button class="discussion-tab active" onclick="showDiscussionSection('{{ ticker.lower() }}', 'full')">å…¨æ–‡</button>
                    <button class="discussion-tab" onclick="showDiscussionSection('{{ ticker.lower() }}', 'tech')">ğŸ“ˆ TECH</button>
                    <button class="discussion-tab" onclick="showDiscussionSection('{{ ticker.lower() }}', 'fund')">ğŸ’° FUND</button>
                    <button class="discussion-tab" onclick="showDiscussionSection('{{ ticker.lower() }}', 'macro')">ğŸŒ MACRO</button>
                    <button class="discussion-tab" onclick="showDiscussionSection('{{ ticker.lower() }}', 'risk')">âš ï¸ RISK</button>
                </div>
                <div class="expert-discussion">
                    <div id="{{ ticker.lower() }}-discussion-full" class="discussion-content active">
                        <pre>{{ discussion }}</pre>
                    </div>
                    <div id="{{ ticker.lower() }}-discussion-tech" class="discussion-content">
                        <pre>{{ discussion | extract_expert('TECH') }}</pre>
                    </div>
                    <div id="{{ ticker.lower() }}-discussion-fund" class="discussion-content">
                        <pre>{{ discussion | extract_expert('FUND') }}</pre>
                    </div>
                    <div id="{{ ticker.lower() }}-discussion-macro" class="discussion-content">
                        <pre>{{ discussion | extract_expert('MACRO') }}</pre>
                    </div>
                    <div id="{{ ticker.lower() }}-discussion-risk" class="discussion-content">
                        <pre>{{ discussion | extract_expert('RISK') }}</pre>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if competitor %}
            <div class="analysis-section" id="{{ ticker.lower() }}-competitor">
                <h3>ğŸ¢ ç«¶åˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h3>
                <div class="competitor-analysis">
                    <pre>{{ competitor }}</pre>
                </div>
            </div>
            {% endif %}
            
        </div>
        {% endfor %}
        
        <div class="footer">
            <p>æœ¬ãƒ¬ãƒãƒ¼ãƒˆã¯æ•™è‚²ç›®çš„ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚æŠ•è³‡åˆ¤æ–­ã¯è‡ªå·±è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚</p>
            <p>ç”Ÿæˆæ—¥æ™‚: {{ generation_time }}</p>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>