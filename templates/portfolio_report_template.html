<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªçµ±åˆãƒ¬ãƒãƒ¼ãƒˆ - {{ report_date }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªçµ±åˆãƒ¬ãƒãƒ¼ãƒˆ</h1>
            <div class="subtitle">å…¨ä½“æˆ¦ç•¥ + 9éŠ˜æŸ„çµ±åˆåˆ†æ - {{ report_date }}</div>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showSection('overview')">ğŸ“Š æ¦‚è¦</div>
            <div class="nav-tab" onclick="showSection('optimization')">ğŸ¯ æœ€é©åŒ–</div>
            
            {% for ticker, info in portfolio.items() %}
            <div class="nav-tab stock-tab" onclick="showSection('{{ ticker.lower() }}')" style="border-left-color: {{ info.color }}">{{ ticker }}</div>
            {% endfor %}
        </div>
        
        <!-- æ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="overview" class="content-section active">
            <h2>ğŸ“Š ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ¦‚è¦</h2>
            
            <div class="overview-header-grid">
                <div class="strategy-summary">
                    <h3>ğŸ¯ æŠ•è³‡æˆ¦ç•¥ã‚µãƒãƒªãƒ¼</h3>
                    <div class="strategy-metrics">
                        <span class="strategy-item">éŠ˜æŸ„æ•°: {{ portfolio|length }}</span>
                        <span class="strategy-item">ã‚»ã‚¯ã‚¿ãƒ¼: {{ sectors|length }}</span>
                        <span class="strategy-item">æœŸé–“: 3-5å¹´</span>
                        <span class="strategy-item">ãƒªã‚¹ã‚¯: ä¸­ã€œé«˜</span>
                    </div>
                </div>
            </div>
            
            <h3 class="scores-section-title">âš–ï¸ 9éŠ˜æŸ„ å°‚é–€å®¶è©•ä¾¡ã‚¹ã‚³ã‚¢</h3>
            <div class="scores-grid-3x3">
                {% for ticker, info in portfolio.items() %}
                <div class="score-card-compact" style="border-color: {{ info.color }}">
                    <div class="score-header-compact">
                        <span class="ticker-compact" style="color: {{ info.color }}">{{ ticker }}</span>
                        <span class="name-compact">{{ info.name }}</span>
                    </div>
                    <div class="investment-decision">
                        {% if expert_scores[ticker].OVERALL >= 4.0 %}
                        <span class="decision-buy">è²·ã„</span>
                        {% elif expert_scores[ticker].OVERALL >= 3.5 %}
                        <span class="decision-hold">æ§˜å­è¦‹</span>
                        {% else %}
                        <span class="decision-wait">è¦‹é€ã‚Š</span>
                        {% endif %}
                    </div>
                    <div class="scores-row-compact">
                        <div class="score-mini tech">
                            <span class="score-label-mini">T</span>
                            <span class="score-value-mini">{{ expert_scores[ticker].TECH }}</span>
                        </div>
                        <div class="score-mini fund">
                            <span class="score-label-mini">F</span>
                            <span class="score-value-mini">{{ expert_scores[ticker].FUND }}</span>
                        </div>
                        <div class="score-mini macro">
                            <span class="score-label-mini">M</span>
                            <span class="score-value-mini">{{ expert_scores[ticker].MACRO }}</span>
                        </div>
                        <div class="score-mini risk">
                            <span class="score-label-mini">R</span>
                            <span class="score-value-mini">{{ expert_scores[ticker].RISK }}</span>
                        </div>
                        <div class="score-mini overall">
                            <span class="score-value-mini overall-mini">{{ expert_scores[ticker].OVERALL }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- æœ€é©åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="optimization" class="content-section">
            <h2>ğŸ¯ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–</h2>
            
            <div class="optimization-content">
                <h3>ç¾åœ¨ã®é…åˆ† vs æ¨å¥¨é…åˆ†</h3>
                <table class="allocation-table">
                    <thead>
                        <tr>
                            <th>éŠ˜æŸ„</th>
                            <th>ã‚»ã‚¯ã‚¿ãƒ¼</th>
                            <th>ç¾åœ¨é…åˆ†</th>
                            <th>æ¨å¥¨é…åˆ†</th>
                            <th>ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ticker, info in portfolio.items() %}
                        <tr>
                            <td>{{ ticker }}</td>
                            <td>{{ info.sector }}</td>
                            <td>{{ optimization.current_allocation[ticker] }}%</td>
                            <td>{{ optimization.recommended_allocation[ticker] }}%</td>
                            <td>
                                <div class="risk-meter" style="width: {{ optimization.risk_metrics[ticker] * 10 }}%; background-color: {% if optimization.risk_metrics[ticker] >= 8 %}#ef4444{% elif optimization.risk_metrics[ticker] <= 4 %}#10b981{% else %}#f59e0b{% endif %}">
                                    {{ optimization.risk_metrics[ticker] }}/10
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- å€‹åˆ¥éŠ˜æŸ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        {% for ticker, info in portfolio.items() %}
        <div id="{{ ticker.lower() }}" class="content-section">
            <div class="stock-header-section" style="background: linear-gradient(135deg, {{ info.color }}20, {{ info.color }}10)">
                <h2 style="color: {{ info.color }}">{{ ticker }} - {{ info.name }}</h2>
                <div class="sector-badge" style="background: {{ info.color }}20; color: {{ info.color }}">{{ info.sector }}</div>
            </div>
            
            <!-- æ ªä¾¡æƒ…å ± -->
            {% if stock_metrics[ticker] %}
            <div class="stock-metrics-section">
                <h3>ğŸ“ˆ ç¾åœ¨ã®æ ªä¾¡æŒ‡æ¨™</h3>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">ç¾åœ¨ä¾¡æ ¼</div>
                        <div class="metric-value">${{ "%.2f" % stock_metrics[ticker].current_price }}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">å‰æ—¥æ¯”</div>
                        <div class="metric-value {% if stock_metrics[ticker].change_pct > 0 %}positive{% else %}negative{% endif %}">
                            {{ "%.2f" % stock_metrics[ticker].change_pct }}%
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">RSI</div>
                        <div class="metric-value">{{ "%.1f" % stock_metrics[ticker].rsi }}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">å‡ºæ¥é«˜</div>
                        <div class="metric-value">{{ "{:,.0f}".format(stock_metrics[ticker].volume) }}</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- 4å°‚é–€å®¶ã‚¹ã‚³ã‚¢ -->
            <div class="expert-scores-section">
                <h3>âš–ï¸ 4å°‚é–€å®¶è©•ä¾¡ã‚¹ã‚³ã‚¢</h3>
                <div class="scores-detail-grid">
                    <div class="score-card tech">
                        <div class="score-type">TECH</div>
                        <div class="score-value">{{ expert_scores[ticker].TECH }}â˜…</div>
                        <div class="score-desc">ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æ</div>
                    </div>
                    <div class="score-card fund">
                        <div class="score-type">FUND</div>
                        <div class="score-value">{{ expert_scores[ticker].FUND }}â˜…</div>
                        <div class="score-desc">ãƒ•ã‚¡ãƒ³ãƒ€ãƒ¡ãƒ³ã‚¿ãƒ«</div>
                    </div>
                    <div class="score-card macro">
                        <div class="score-type">MACRO</div>
                        <div class="score-value">{{ expert_scores[ticker].MACRO }}â˜…</div>
                        <div class="score-desc">ãƒã‚¯ãƒ­ç’°å¢ƒ</div>
                    </div>
                    <div class="score-card risk">
                        <div class="score-type">RISK</div>
                        <div class="score-value">{{ expert_scores[ticker].RISK }}â˜…</div>
                        <div class="score-desc">ãƒªã‚¹ã‚¯ç®¡ç†</div>
                    </div>
                </div>
            </div>
            
            <!-- è²¡å‹™æŒ‡æ¨™ -->
            {% if financial_metrics[ticker] %}
            <div class="financial-metrics-section">
                <h3>ğŸ’° è²¡å‹™æŒ‡æ¨™</h3>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">æ™‚ä¾¡ç·é¡</div>
                        <div class="metric-value">${{ "{:,.0f}".format(financial_metrics[ticker].market_cap / 1000000) }}M</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">P/Eæ¯”ç‡</div>
                        <div class="metric-value">{{ financial_metrics[ticker].pe_ratio if financial_metrics[ticker].pe_ratio != 'N/A' else 'N/A' }}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">åˆ©ç›Šç‡</div>
                        <div class="metric-value">{{ "%.1f" % (financial_metrics[ticker].profit_margin * 100) }}%</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">å£²ä¸Šæˆé•·ç‡</div>
                        <div class="metric-value">{{ "%.1f" % (financial_metrics[ticker].revenue_growth * 100) }}%</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            
            <!-- è©³ç´°è¨è«–ãƒ¬ãƒãƒ¼ãƒˆ -->
            {% if detailed_discussion_reports[ticker] %}
            <div class="analysis-section" id="{{ ticker.lower() }}-detailed-discussion">
                <h3>ğŸ“š 4å°‚é–€å®¶è¨è«–ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                <div class="detailed-discussion-wrapper">
                    <div class="detailed-discussion-content markdown-content">
                        {{ detailed_discussion_reports[ticker]|markdown_to_html|safe }}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- ç«¶åˆåˆ†æ -->
            {% if competitor_reports[ticker] %}
            <div class="analysis-section" id="{{ ticker.lower() }}-competitor">
                <h3>ğŸ¢ ç«¶åˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h3>
                <div class="competitor-content markdown-content">
                    {{ competitor_reports[ticker]|markdown_to_html|safe }}
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <script src="script.js"></script>
</body>
</html>